# GitHub Copilot Instructions for CampusCompanion

## Project Overview
CampusCompanion (formerly CampusConnect) is a collaborative platform for university learning communities built with Next.js 15, TypeScript, Firebase, and Tailwind CSS. It features discussion forums, resource sharing, event management, and user profiles with role-based access control.

## Technology Stack
- **Framework**: Next.js 15 with App Router
- **Language**: TypeScript
- **Authentication**: Firebase Auth with custom role-based permissions
- **Database**: Cloud Firestore
- **Storage**: Firebase Storage
- **Styling**: Tailwind CSS with custom design system
- **UI Components**: Radix UI with custom implementations
- **Icons**: Lucide React
- **AI Integration**: Google Genkit for smart resource suggestions

## Project Structure & Conventions

### File Organization
```
src/
├── app/                    # Next.js App Router pages
│   ├── api/               # API routes with authentication
│   ├── (auth)/            # Authentication pages
│   └── [feature]/         # Feature-specific pages
├── components/            # Reusable React components
│   ├── ui/               # Base UI components (Radix-based)
│   └── [FeatureComponent].tsx
├── contexts/             # React contexts (AuthContext)
├── hooks/               # Custom React hooks
├── lib/                 # Utilities and configurations
└── types/               # TypeScript type definitions
```

### Naming Conventions
- **Files**: PascalCase for components (`UserProfile.tsx`), camelCase for utilities (`auth-admin.ts`)
- **Components**: PascalCase with descriptive names (`AppHeader`, `ProtectedRoute`)
- **API Routes**: RESTful structure (`/api/resources`, `/api/forums/[id]`)
- **Database Collections**: camelCase (`forumThreads`, `users`, `resources`)

## Authentication & Authorization Patterns

### User Roles
- **Student**: Default role, can create content and interact
- **Moderator**: Can moderate forums and events
- **Admin**: Full access to all features and admin panel

### API Route Structure
Every protected API route should follow this pattern:

```typescript
export async function POST(request: NextRequest) {
  try {
    // Extract token from cookie or header
    const token = request.cookies.get('auth-token')?.value || 
                  request.headers.get('authorization')?.replace('Bearer ', '');

    if (!token) {
      return NextResponse.json(
        { error: 'Authentication required' },
        { status: 401 }
      );
    }

    // Verify the token
    const decodedToken = await adminAuth.verifyIdToken(token);
    if (!decodedToken) {
      return NextResponse.json(
        { error: 'Invalid token' },
        { status: 401 }
      );
    }

    // Get user profile for role checking
    const userProfile = await getUserProfile(decodedToken.uid);
    if (!userProfile) {
      return NextResponse.json(
        { error: 'User profile not found' },
        { status: 404 }
      );
    }

    // Your API logic here

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('Error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### Role-Based Authorization
For admin/moderator-only endpoints, add role checking:

```typescript
const hasPermission = await checkUserRole(decodedToken.uid, ['Admin', 'Moderator']);
if (!hasPermission) {
  return NextResponse.json(
    { error: 'Insufficient permissions. Admin or Moderator role required.' },
    { status: 403 }
  );
}
```

## Component Patterns

### Page Components
All pages should use the `PageWrapper` component:

```tsx
import { PageWrapper } from '@/components/PageWrapper';
import { ProtectedRoute } from '@/components/ProtectedRoute';

export default function FeaturePage() {
  return (
    <ProtectedRoute requiredRoles={['Student']}> {/* Optional role restriction */}
      <PageWrapper title="Page Title">
        {/* Your page content */}
      </PageWrapper>
    </ProtectedRoute>
  );
}
```

### Form Components
Use React Hook Form with Zod validation and toast notifications:

```tsx
import { useToast } from '@/hooks/use-toast';
import { Button } from '@/components/ui/button';

const { toast } = useToast();

const handleSubmit = async (data: FormData) => {
  try {
    // API call
    toast({
      title: "Success",
      description: "Operation completed successfully.",
    });
  } catch (error: any) {
    toast({
      variant: "destructive",
      title: "Error",
      description: error.message,
    });
  }
};
```

### Authentication Integration
Use the `useAuth` hook for user state:

```tsx
import { useAuth } from '@/contexts/AuthContext';

const { user, userProfile, loading, isAdmin, canModerate } = useAuth();
```

## Design System

### Typography
- **Headlines**: `font-headline` (Space Grotesk)
- **Body text**: `font-body` (PT Sans)
- **Code**: `font-code` (monospace)

### Colors
- **Primary**: `#5DADE2` (calm blue) - `bg-primary`, `text-primary`
- **Background**: `#F0F4F7` (light gray) - `bg-background`
- **Accent**: `#E67E22` (warm orange) - `bg-accent`, `text-accent-foreground`
- Use CSS custom properties: `hsl(var(--primary))`, etc.

### Component Styling
- Use Tailwind utility classes consistently
- Card-based layouts with proper spacing: `p-4 md:p-6 lg:p-8`
- Responsive design: mobile-first approach
- Use Radix UI components for accessibility

### Icon Usage
- Use Lucide React icons consistently
- Outlined style for modern, clean interface
- Standard sizes: `w-4 h-4`, `w-6 h-6`, `w-8 h-8`

## Database Schema Patterns

### User Profile
```typescript
interface UserProfile {
  name: string;
  email: string;
  role: 'Student' | 'Admin' | 'Moderator';
  bio: string;
  avatar: string;
  pinnedResources: string[];
  rsvpedEvents: string[];
}
```

### Forum Thread
```typescript
interface ForumThread {
  title: string;
  course: string;
  tags: string[];
  body: string;
  author: string;
  authorId: string;
  upvotes: number;
  replies: number;
  upvotedBy: string[];
  pinned?: boolean;
  locked?: boolean;
  timestamp: Timestamp;
  createdAt: string;
}
```

### Resource
```typescript
interface Resource {
  name: string;
  category: string;
  fileType: string;
  url: string;
  uploader: string;
  uploaderId: string;
  date: string;
  timestamp: Timestamp;
  downloads: number;
}
```

## Error Handling

### API Errors
Always return consistent error responses:

```typescript
return NextResponse.json(
  { error: 'Descriptive error message' },
  { status: 400 | 401 | 403 | 404 | 500 }
);
```

### Client-Side Error Handling
Use try-catch blocks with toast notifications:

```typescript
try {
  const response = await apiCall();
  // Success handling
} catch (error: any) {
  toast({
    variant: "destructive",
    title: "Operation Failed",
    description: error.message || "An unexpected error occurred.",
  });
}
```

## Code Quality Standards

### TypeScript
- Always use proper TypeScript types
- Define interfaces for all data structures
- Use strict mode settings from `tsconfig.json`
- Prefer explicit return types for functions

### React Best Practices
- Use functional components with hooks
- Implement proper loading and error states
- Use React.memo for performance optimization when needed
- Follow the hooks rules (don't call in loops/conditions)

### Security Considerations
- Always validate user input on both client and server
- Use Firebase Admin SDK for server-side operations
- Implement proper CORS headers where needed
- Never expose sensitive data in client-side code

## AI Integration (Genkit)

When implementing AI features:
- Use the existing Genkit setup in `src/ai/`
- Follow the pattern for AI-powered resource suggestions
- Implement proper error handling for AI service calls
- Consider rate limiting and cost management

## Testing Patterns

When writing tests:
- Test API endpoints with proper authentication mocking
- Test component rendering with different user roles
- Mock Firebase services in test environment
- Test error boundaries and loading states

## Development Commands
- `npm run dev` - Start development server on port 9002
- `npm run build` - Build for production
- `npm run lint` - Run ESLint
- `npm run typecheck` - TypeScript type checking
- `npm run genkit:dev` - Start Genkit development

## Environment Variables
Required environment variables:
- `FIREBASE_CLIENT_EMAIL`
- `FIREBASE_PRIVATE_KEY`
- `FIREBASE_PROJECT_ID`
- `NEXT_PUBLIC_FIREBASE_API_KEY`
- `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`

## Code Generation Guidelines

When generating new code for this project:

1. **Follow the established patterns** shown in existing components and API routes
2. **Use the existing design system** colors, fonts, and component structure
3. **Implement proper authentication** for all protected features
4. **Include error handling** with toast notifications
5. **Use TypeScript interfaces** for all data structures
6. **Follow the file organization** conventions
7. **Include loading states** for async operations
8. **Use the existing UI components** from `components/ui/`
9. **Implement responsive design** with Tailwind classes
10. **Add proper JSDoc comments** for complex functions

## Feature-Specific Guidelines

### Forums
- Support upvoting, pinning, and locking threads
- Implement proper moderation controls
- Use rich text formatting for posts
- Include course/subject categorization

### Resources
- Support file upload with preview
- Implement download tracking
- Add search and filtering capabilities
- Include resource categorization

### Events
- Support RSVP functionality
- Include calendar integration
- Send notifications for upcoming events
- Support recurring events

### User Management
- Implement role-based permissions
- Support profile customization
- Include activity tracking
- Add user verification features

Remember: This project emphasizes clean, maintainable code with excellent user experience and proper security measures. Always prioritize user privacy and data protection.
